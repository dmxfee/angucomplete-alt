"use strict";!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b(require("angular")):"function"==typeof define&&define.amd?define(["angular"],b):b(a.angular)}(window,function(a){a.module("angucomplete-alt",[]).directive("angucompleteAlt",["$q","$parse","$http","$sce","$timeout","$templateCache",function(a,b,c,d,e,f){var g=40,h=38,i=13,j="/angucomplete-alt/index.html";return f.put(j,'<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name={{inputName}} ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">    <div class="angucomplete-searching" ng-if="!hideTextSearching" ng-show="searching" ng-bind="textSearching"></div>    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>      </div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>    </div>  </div></div>'),{restrict:"EA",require:"^?form",scope:{selectedObject:"=?",disableInput:"=?",initialValue:"=?",localData:"=?",remoteUrlRequestFormatter:"=?",remoteUrlRequestWithCredentials:"@",remoteUrlResponseFormatter:"=?",remoteUrlErrorCallback:"=?",remoteApiHandler:"=?",id:"@",type:"@",placeholder:"@",remoteUrl:"@",remoteUrlDataField:"@",titleField:"@",descriptionField:"@",imageField:"@",inputClass:"@",pause:"@",searchFields:"@",minlength:"@",matchClass:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"@",fieldRequiredClass:"@",inputChanged:"=?",autoMatch:"@",focusOut:"&",focusIn:"&",inputName:"@",searchStr:"@",hideWhileSearching:"=",highlightExactMatch:"=",hideTextSearching:"=",hideNoResults:"=",preventInvokeApply:"=",preventCssComputation:"="},templateUrl:function(a,b){return b.templateUrl||j},link:function(b,f,j,k){function l(a){fa=null,b.hideResults(a),document.body.removeEventListener("click",l)}function m(a){return a.which?a.which:a.keyCode}function n(a){"function"==typeof b.selectedObject?b.selectedObject(a):b.selectedObject=a,t(!!a)}function o(a){return function(c){return b[a]?b[a](c):c}}function p(a){n({originalObject:a}),b.clearSelected&&(b.searchStr=null),L()}function q(a){return b.titleField.split(",").map(function(b){return r(a,b)}).join(" ")}function r(a,b){var c,d;if(b){c=b.split("."),d=a;for(var e=0;e<c.length;e++)d=d[c[e]]}else d=a;return d}function s(a,c){var e,f,g;if(g=new RegExp(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),a)return a.match&&a.replace||(a=a.toString()),f=a.match(g),e=f?a.replace(g,'<span class="'+b.matchClass+'">'+f[0]+"</span>"):a,d.trustAsHtml(e)}function t(a){b.notEmpty=a,ba=b.searchStr,b.fieldRequired&&k&&k.$setValidity(aa,a)}function u(a){var c=m(a);if(37!==c&&39!==c)if(c===h||c===i)a.preventDefault();else if(c===g)a.preventDefault(),!b.showDropdown&&b.searchStr&&b.searchStr.length>=$&&(M(),b.searching=!0,P(b.searchStr));else if(27===c)L(),Z&&(b.preventInvokeApply?Y.val(b.searchStr):b.$apply(function(){Y.val(b.searchStr)}));else{if(0===$&&!b.searchStr)return;b.searchStr&&""!==b.searchStr||(b.showDropdown=!1),ba&&ba!==b.searchStr&&!b.clearSelected&&(b.preventInvokeApply?n():b.$apply(function(){n()}))}}function v(a){!b.overrideSuggestions||b.selectedObject&&b.selectedObject.originalObject===b.searchStr||(a&&a.preventDefault(),p(b.searchStr))}function w(a){var b=getComputedStyle(a);return a.offsetHeight+parseInt(b.marginTop,10)+parseInt(b.marginBottom,10)}function x(){return da.getBoundingClientRect().top+parseInt(getComputedStyle(da).maxHeight,10)}function y(){return f[0].querySelectorAll(".angucomplete-row")[b.currentIndex]}function z(){return y().getBoundingClientRect().top-(da.getBoundingClientRect().top+parseInt(getComputedStyle(da).paddingTop,10))}function A(a){da.scrollTop=da.scrollTop+a}function B(){var a=b.results[b.currentIndex];b.matchClass?Y.val(q(a.originalObject)):Y.val(a.title)}function C(){b.currentIndex++,Z&&B()}function D(){b.currentIndex--,Z&&B()}function E(){b.currentIndex=-1,Z&&Y.val(b.searchStr)}function F(a){var c=m(a),d=null,e=null;c===i&&b.results?(b.currentIndex>=0&&b.currentIndex<b.results.length?(a.preventDefault(),b.selectResult(b.results[b.currentIndex])):(v(a),L()),b.preventInvokeApply||b.$apply()):c===g&&b.results?(a.preventDefault(),b.currentIndex+1<b.results.length&&b.showDropdown&&(b.preventInvokeApply?C():b.$apply(function(){C()}),ea&&!b.preventCssComputation&&(d=y(),x()<d.getBoundingClientRect().bottom&&A(w(d))))):c===h&&b.results?(a.preventDefault(),b.currentIndex>=1?(b.preventInvokeApply?D():b.$apply(function(){D()}),ea&&!b.preventCssComputation&&(e=z())<0&&A(e-1)):0===b.currentIndex&&(b.preventInvokeApply?E():b.$apply(function(){E()}))):9===c&&(b.results&&b.results.length>0&&b.showDropdown?-1===b.currentIndex&&b.overrideSuggestions?v():(-1===b.currentIndex&&(b.currentIndex=0),b.selectResult(b.results[b.currentIndex]),b.$digest()):b.searchStr&&b.searchStr.length>0&&v())}function G(a){return function(c,d,e,f){d||e||f||(c=c.data),b.searching=!1,Q(r(T(c),b.remoteUrlDataField),a)}}function H(a,c,d,e){c||d||e||(c=a.status),0!==c&&(b.remoteUrlErrorCallback?b.remoteUrlErrorCallback(a,c,d,e):console&&console.error&&console.error("http error"))}function I(){ca&&ca.resolve()}function J(d){var e={},f=b.remoteUrl+encodeURIComponent(d);b.remoteUrlRequestFormatter&&(e={params:b.remoteUrlRequestFormatter(d)},f=b.remoteUrl),b.remoteUrlRequestWithCredentials&&(e.withCredentials=!0),I(),ca=a.defer(),e.timeout=ca.promise,c.get(f,e).success(G(d)).error(H)}function K(c){I(),ca=a.defer(),b.remoteApiHandler(c,ca.promise).then(G(c)).catch(H)}function L(){b.showDropdown=!1,b.results=[],da&&(da.scrollTop=0)}function M(){b.showDropdown=!b.hideWhileSearching||!(b.hideNoResults&&b.results&&0===b.results.length),b.currentIndex=-1}function N(a){var c,d,e,f,g=b.searchFields.split(","),h=[];for(c=0;c<b.localData.length;c++){for(d=!1,e=0;e<g.length;e++)f=r(b.localData[c],g[e])||"",d=d||f.toString().toLowerCase().indexOf(a.toString().toLowerCase())>=0;d&&(h[h.length]=b.localData[c])}return b.searching=!1,h}function O(a,b,c){var d=!1;if(c)for(var e in b)b[e].toLowerCase()===c.toLowerCase()&&(d=!0);return d}function P(a){if(!a||a.length<$)return void(b.results=[]);if(b.localData){var c,d="function"==typeof b.localSearch?b.localSearch:N;b.preventInvokeApply?c=d(a,b.localData):b.$apply(function(){c=d(a,b.localData)}),Q(c,a)}else b.remoteApiHandler?K(a):J(a)}function Q(a,c){var d,e,f,g,h,i;if(a&&a.length>0){for(b.results=[],d=0;d<a.length;d++)if(b.titleField&&""!==b.titleField&&(g=h=q(a[d])),e="",b.descriptionField&&(e=i=r(a[d],b.descriptionField)),f="",b.imageField&&(f=r(a[d],b.imageField)),b.matchClass&&(h=s(g,c),i=s(e,c)),b.results[b.results.length]={title:h,description:i,image:f,originalObject:a[d]},b.autoMatch||b.highlightExactMatch){var j=b.results.length-1,k=b.results[j],l=O(k,{title:g,desc:e||""},b.searchStr);l&&(b.autoMatch?b.selectResult(k):b.currentIndex=j)}0===b.results.length&&b.hideNoResults?b.showDropdown=!1:b.showDropdown=!0}else b.results=[],b.hideNoResults&&(b.showDropdown=!1);b.preventInvokeApply&&b.$digest()}function R(){b.localData?Q(b.localData,""):b.remoteApiHandler?K(""):J("")}var S,T,U,V,W,X,Y=f.find("input"),Z=Y.length>0,$=3,_=null,aa="autocomplete-required",ba=null,ca=null,da=f[0].querySelector(".angucomplete-dropdown"),ea=!1,fa=null;X=f.on("mousedown",function(a){a.target.id?(fa=a.target.id)===b.id+"_dropdown"&&document.body.addEventListener("click",l):fa=a.target.className}),b.currentIndex=null,b.searching=!1,U=b.$watch("initialValue",function(a,c){a&&(U(),"object"==typeof a?(b.searchStr=q(a),n({originalObject:a})):"string"==typeof a&&a.length>0?b.searchStr=a:console&&console.error&&console.error("Tried to set initial value of angucomplete to",a,"which is an invalid value"),t(!0))}),b.$on("angucomplete-alt:clearInput",function(a,c){c&&c!==b.id||(b.searchStr=null,n(),t(!1),L())}),b.onFocusHandler=function(){b.focusIn&&b.focusIn(),0!==$||b.searchStr&&0!==b.searchStr.length||(b.showDropdown=!0,R())},b.hideResults=function(a){var c=!0;b.preventInvokeApply&&(c=!1),fa&&(fa===b.id+"_dropdown"||fa.indexOf("angucomplete")>=0)?fa=null:(S=e(function(){L(),b.searchStr&&b.searchStr.length>0&&(b.preventInvokeApply?Y.val(b.searchStr):b.$apply(function(){Y.val(b.searchStr)}))},200,c),I(),b.focusOut&&b.focusOut(),b.overrideSuggestions&&b.searchStr&&b.searchStr.length>0&&-1===b.currentIndex&&v())},b.resetHideResults=function(){S&&e.cancel(S)},b.hoverRow=function(a){b.currentIndex=a},b.selectResult=function(a){b.matchClass&&(a.title=q(a.originalObject),a.description=r(a.originalObject,b.descriptionField)),b.clearSelected?b.searchStr=null:b.searchStr=a.title,n(a),L()},b.inputChangeHandler=function(a){if(a.length<$)L();else if(0===a.length&&0===$)b.searching=!1,R();else{M(),_&&e.cancel(_),b.searching=!0;var c=!0;b.preventInvokeApply&&(c=!1),_=e(function(){P(b.searchStr)},b.pause,c)}return b.inputChanged&&(a=b.inputChanged(a)),a},b.fieldRequiredClass&&""!==b.fieldRequiredClass&&(aa=b.fieldRequiredClass),b.minlength&&""!==b.minlength&&($=parseInt(b.minlength,10)),b.pause||(b.pause=500),b.clearSelected||(b.clearSelected=!1),b.overrideSuggestions||(b.overrideSuggestions=!1),b.fieldRequired&&k&&t(!!b.initialValue),b.inputType=j.type?j.type:"text",b.textSearching=j.textSearching?j.textSearching:"Searching...",b.textNoResults=j.textNoResults?j.textNoResults:"No results found",b.maxlength=j.maxlength?j.maxlength:524288,Z?(V=Y.on("keydown",F),W=Y.on("keyup",u)):(b.keydownHandler=F,b.keyupHandler=u),T=o("remoteUrlResponseFormatter"),b.$on("$destroy",function(){t(!0),Z&&(Y.off(V),Y.off(W),Y.off(X))}),b.preventCssComputation||e(function(){var a=getComputedStyle(da);ea=a.maxHeight&&"auto"===a.overflowY})}}}])});